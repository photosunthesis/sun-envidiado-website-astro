---
import BaseLayout from "./BaseLayout.astro";

const backUrlLabel = ":back<Enter>";
const homeUrlLabel = ":home<Enter>";
const { frontmatter = {}, ...restProps } = Astro.props || {};

// Extract common SEO fields from frontmatter
const {
  title = "Blog",
  description = "",
  pubDate = undefined,
  tags = [],
} = frontmatter;

// Pass all remaining props except frontmatter fields
const rest = { ...restProps };
delete rest.title;
delete rest.description;
delete rest.pubDate;
delete rest.tags;

// --- Canonical/OG URL logic ---
const canonical = new URL(
  String(Astro.url?.pathname || "/").replace(/\/?$/, "/"),
  Astro.site || "https://sun-envidiado.com",
).toString();

// Site-wide defaults and full URLs
const siteBase = Astro.site || "https://sun-envidiado.com";
const fullImage = new URL("/android-chrome-512x512.png", siteBase).toString();

// Title and type helpers
const titleToUse = `${title}${title.includes("Sun") ? "" : " â€” Sun Envidiado"}`;
const typeToUse = pubDate ? "article" : "collection";

// JSON-LD for individual blog posts (when pubDate is present)
let jsonLd = null;
if (pubDate) {
  jsonLd = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    headline: title,
    description,
    mainEntityOfPage: {
      "@type": "WebPage",
      "@id": canonical,
    },
    url: canonical,
    image: fullImage,
    author: {
      "@type": "Person",
      name: "Sun Envidiado",
      url: siteBase,
    },
    datePublished: new Date(pubDate).toISOString(),
    dateModified: new Date(pubDate).toISOString(),
  };
}
---

<BaseLayout
  title={titleToUse}
  description={description}
  url={canonical}
  image={fullImage}
  type={typeToUse}
  pubDate={pubDate}
  tags={tags}
  jsonLd={jsonLd}
>
  <div class="blog-layout">
    <h1 id="post-title" class="blog-title">{title}</h1>
    <p class="post-pub-date">
      {
        pubDate
          ? new Date(pubDate).toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          : ""
      }
    </p>
    {
      pubDate ? (
        <article class="blog-article" aria-labelledby="post-title">
          <slot />
        </article>
      ) : (
        <slot />
      )
    }
    <footer
      class="blog-footer"
      role="contentinfo"
      aria-label="Post navigation and actions"
    >
      <p class="blog-footer-text">
        Type
        <a
          href="#"
          onclick="history.back(); return false;"
          aria-label="Go back"
        >
          {backUrlLabel}
        </a>
        to return to the previous page, or
        <a href="/" aria-label="Go to homepage">{homeUrlLabel}</a>
        to go to the homepage.
      </p>
    </footer>
  </div>
</BaseLayout>
