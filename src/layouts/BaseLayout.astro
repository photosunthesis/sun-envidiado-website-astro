---
import '../styles/main.scss';
import { buildSEOMetadata, SITE_CONFIG } from '../utils/seo';

const isProd = import.meta.env && import.meta.env.PROD;
const props = Astro.props;
const frontmatter = props.frontmatter || props;

const seo = buildSEOMetadata({
  frontmatter,
  pathname: Astro.url.pathname,
  site: Astro.site,
});

const jsonLd = frontmatter.jsonLd || null;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{seo.title}</title>
    <meta name="theme-color" content="#000000" />
    <meta name="msapplication-navbutton-color" content="#000000" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="#000000" />
    <meta name="description" content={seo.description} />
    <meta name="robots" content={seo.noIndex ? 'noindex, nofollow' : 'index, follow'} />
    <link rel="canonical" href={seo.canonical} />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <meta name="color-scheme" content="light dark" />
    <meta name="author" content={seo.author || SITE_CONFIG.authorName} />
    <link rel="sitemap" href="/sitemap-index.xml" />

    {seo.pubDate && <meta property="article:published_time" content={seo.pubDate} />}
    {seo.author && <meta property="article:author" content={seo.author} />}
    {
      seo.tags &&
        Array.isArray(seo.tags) &&
        seo.tags.length > 0 &&
        seo.tags.map((tag: string) => <meta property="article:tag" content={tag} />)
    }

    <meta property="og:site_name" content={SITE_CONFIG.siteName} />
    <meta property="og:type" content={seo.type} />
    <meta property="og:title" content={seo.title} />
    <meta property="og:description" content={seo.description} />
    <meta property="og:url" content={seo.canonical} />
    <meta property="og:image" content={seo.imageUrl} />

    <meta name="twitter:card" content={seo.imageUrl ? 'summary_large_image' : 'summary'} />
    <meta name="twitter:title" content={seo.title} />
    <meta name="twitter:description" content={seo.description} />
    <meta name="twitter:image" content={seo.imageUrl} />

    <slot name="seo" />

    <link
      rel="preload"
      href="/fonts/Web437_ToshibaSat_8x14.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    {jsonLd && <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />}

    {
      isProd && (
        <script
          defer
          src="https://umami.sun-envidiado.com/script.js"
          data-website-id="bbd2687f-9a6a-4aa4-8813-f5f431278ef6"
        />
      )
    }
  </head>
  <body>
    <a class="skip-link" href="#main" aria-label="Skip to main content">Skip to content</a>
    <main id="main">
      <div class="content-wrapper">
        <slot />
      </div>
    </main>
    <div id="crt-overlay-container"></div>
  </body>
</html>
