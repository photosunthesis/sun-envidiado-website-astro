---
import { Seo } from 'astro-seo-meta';
import { Schema } from 'astro-seo-schema';
import '../styles/main.scss';
import { buildSEOMetadata, SITE_CONFIG } from '../utils/seo';

const isProd = import.meta.env && import.meta.env.PROD;
const props = Astro.props;
const frontmatter = props.frontmatter || props;

const seo = buildSEOMetadata({
  frontmatter,
  pathname: Astro.url.pathname,
  site: Astro.site,
});

const jsonLd = frontmatter.jsonLd || null;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <Seo
      title={seo.title}
      description={seo.description}
      keywords={seo.tags}
      icon="/favicon-32x32.png"
      themeColor="#000000"
      colorScheme={'light dark' as any}
      robots={seo.noIndex ? 'noindex, nofollow' : 'index, follow'}
      facebook={{
        image: seo.imageUrl,
        url: seo.canonical,
        type: seo.type as any,
      }}
      twitter={{
        image: seo.imageUrl,
        card: seo.imageUrl ? 'summary_large_image' : 'summary',
      }}
    />

    <link rel="canonical" href={seo.canonical} />
    <meta name="author" content={seo.author || SITE_CONFIG.authorName} />
    <link rel="sitemap" href="/sitemap-index.xml" />

    {seo.pubDate && <meta property="article:published_time" content={seo.pubDate} />}
    {seo.author && <meta property="article:author" content={seo.author} />}
    {
      seo.tags &&
        Array.isArray(seo.tags) &&
        seo.tags.length > 0 &&
        seo.tags.map((tag: string) => <meta property="article:tag" content={tag} />)
    }

    <meta property="og:site_name" content={SITE_CONFIG.siteName} />

    <slot name="seo" />

    <link
      rel="preload"
      href="/fonts/Web437_ToshibaSat_8x14.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    {jsonLd && <Schema item={jsonLd} />}

    {
      isProd && (
        <script
          defer
          src="https://umami.sun-envidiado.com/script.js"
          data-website-id="bbd2687f-9a6a-4aa4-8813-f5f431278ef6"
        />
      )
    }
  </head>
  <body>
    <a class="skip-link" href="#main" aria-label="Skip to main content">Skip to content</a>
    <main id="main">
      <div class="content-wrapper">
        <slot />
      </div>
    </main>
    <div id="crt-overlay-container"></div>
  </body>
</html>
