---
import { SEO } from 'astro-seo';
import { Schema } from 'astro-seo-schema';
import '../styles/main.scss';
import { buildSEOMetadata, SITE_CONFIG } from '../utils/seo';

const isProd = import.meta.env && import.meta.env.PROD;
const props = Astro.props;
const frontmatter = props.frontmatter || props;

const seo = buildSEOMetadata({
  frontmatter,
  pathname: Astro.url.pathname,
  site: Astro.site,
});

const jsonLd = frontmatter.jsonLd || null;
---

<html lang="en">
  <head>
    <SEO
      charset="utf-8"
      title={seo.title}
      description={seo.description}
      canonical={seo.canonical}
      noindex={seo.noIndex}
      nofollow={seo.noIndex}
      openGraph={{
        basic: {
          title: seo.title,
          type: seo.type,
          image: seo.imageUrl,
          url: seo.canonical,
        },
        image: {
          alt: seo.title,
        },
        optional: {
          description: seo.description,
          siteName: SITE_CONFIG.siteName,
        },
        article: {
          publishedTime: seo.pubDate,
          authors: seo.author ? [seo.author] : undefined,
          tags: seo.tags,
        },
      }}
      twitter={{
        card: seo.imageUrl ? 'summary_large_image' : 'summary',
        image: seo.imageUrl,
        title: seo.title,
        description: seo.description,
      }}
      extend={{
        link: [
          { rel: 'icon', href: '/favicon-16x16.png', type: 'image/png', sizes: '16x16' },
          { rel: 'icon', href: '/favicon-32x32.png', type: 'image/png', sizes: '32x32' },
          { rel: 'apple-touch-icon', href: '/apple-touch-icon.png', sizes: '180x180' },
          { rel: 'manifest', href: '/site.webmanifest' },
          { rel: 'sitemap', href: '/sitemap-index.xml' },
          {
            rel: 'preload',
            href: '/fonts/Web437_ToshibaSat_8x14.woff2',
            as: 'font',
            type: 'font/woff2',
            crossorigin: '',
          },
        ],
        meta: [
          { name: 'theme-color', content: '#09090b' },
          { name: 'color-scheme', content: 'light dark' },
          { name: 'author', content: seo.author || SITE_CONFIG.authorName },
          { name: 'viewport', content: 'width=device-width, initial-scale=1' },
        ],
      }}
    />

    {jsonLd && <Schema item={jsonLd} />}

    {
      isProd && (
        <script
          defer
          src="https://umami.sun-envidiado.com/script.js"
          data-website-id="bbd2687f-9a6a-4aa4-8813-f5f431278ef6"
        />
      )
    }
  </head>
  <body>
    <a class="skip-link" href="#main" aria-label="Skip to main content">Skip to content</a>
    <main id="main">
      <div class="content-wrapper">
        <slot />
      </div>
    </main>
    <div id="crt-overlay-container"></div>
  </body>
</html>
