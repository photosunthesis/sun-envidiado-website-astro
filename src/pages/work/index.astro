---
import { Picture } from 'astro:assets';
import BaseLayout from '../../layouts/BaseLayout.astro';
import bebiAppImage from './_assets/bebi-app.png';
import haandvaerkerImage from './_assets/haandvaerker-dk.png';
import rateStuffImage from './_assets/rate-stuff-online.png';

const startDate = new Date('2019-03-01');
const today = new Date();
let years = today.getFullYear() - startDate.getFullYear();
if (
  today.getMonth() < startDate.getMonth() ||
  (today.getMonth() === startDate.getMonth() && today.getDate() < startDate.getDate())
) {
  years--;
}

const seoMeta = {
  title: 'Work — Sun Envidiado',
  description: `Check out my work experience as a Flutter Developer with ${years} years of experience building cross-platform mobile applications.`,
  tags: ['sun envidiado', 'flutter developer', 'work experience', 'mobile developer', 'portfolio'],
};

const siteBase = Astro.site || 'https://sun-envidiado.com';
const imageUrl = new URL('/default.png', siteBase).toString();

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ProfilePage',
  mainEntity: {
    '@type': 'Person',
    '@id': `${siteBase}/#person`,
    name: 'Sun Envidiado',
    url: siteBase,
    image: imageUrl,
    jobTitle: 'Flutter Developer',
    description: seoMeta.description,
  },
};

const asciiArtHeader = `
▗▖ ▗▖ ▗▄▖ ▗▄▄▖ ▗▖ ▗▖
▐▌ ▐▌▐▌ ▐▌▐▌ ▐▌▐▌▗▞▘
▐▌ ▐▌▐▌ ▐▌▐▛▀▚▖▐▛▚▖ 
▐▙█▟▌▝▚▄▞▘▐▌ ▐▌▐▌ ▐▌
                    
`;

const experiences = [
  {
    period: 'Jun 2025 — Present',
    company: 'Miquido',
    role: 'Flutter Developer',
    description: `Building cross-platform apps for fintech and healthcare industries. I integrated AI capabilities into Flutter applications, working with LLM APIs and implementing intelligent features that enhance user experience.`,
  },
  {
    period: 'Nov 2023 — Jun 2025',
    company: 'Nextbank',
    role: 'Flutter Developer',
    description:
      'Built cross-platform apps for fintech corporations. I developed a custom Flutter plugin for liveness checks for banking apps, blending native iOS and Android code to keep things secure.',
  },
  {
    period: 'Aug 2022 — Nov 2023',
    company: 'Hedgehog Lab',
    role: 'Mobile Engineer',
    description:
      'Worked on mobile apps for the medical and fintech sectors. Here, I built a Flutter plugin for document signing that hooked into native iOS and Android functionality.',
  },
  {
    period: 'Jan 2021 — Aug 2022',
    company: 'CRAFT-TEC Inc.',
    role: 'Software Engineer',
    description:
      'Led the Flutter team while wearing a few different hats as a full-stack engineer. I built out backend APIs with Laravel and helped mentor other devs on the team.',
  },
  {
    period: 'Mar 2019 — Jan 2021',
    company: 'Various Organizations',
    role: 'Web Developer',
    description:
      'Worked on a bunch of different web projects using everything from Vue and React to .NET and Shopify. This is where I really got comfortable with the web development space.',
  },
];

const projects = [
  {
    title: 'rate-stuff.online',
    url: 'https://rate-stuff.online',
    image: rateStuffImage,
    alt: 'Screenshot of rate-stuff.online',
    description:
      'A side project I built with React and TanStack Start, deployed on Cloudflare Workers. It was my first real deep dive into the React ecosystem and serverless architecture.',
  },
  {
    title: 'Bebi App',
    url: 'https://github.com/photosunthesis/bebi-app-flutter',
    image: bebiAppImage,
    alt: 'Screenshot of Bebi App',
    description:
      'A couples app I made for my girlfriend :D featuring image sharing, a shared calendar, and menstruation cycle tracking. Just a side hobby project I enjoyed building.',
  },
  {
    title: 'Haandvaerker.dk',
    url: 'https://www.haandvaerker.dk/',
    image: haandvaerkerImage,
    alt: 'Screenshot of Haandvaerker.dk',
    description:
      'A platform connecting homeowners in Denmark with craftsmen. This was the main project I worked on at CRAFT-TEC Inc., where I built both the homeowner and craftsman Flutter apps and helped out with the backend.',
  },
];
---

<BaseLayout
  title={seoMeta.title}
  description={seoMeta.description}
  tags={seoMeta.tags}
  type="website"
  jsonLd={jsonLd}
>
  <div class="work-content">
    <article class="work-article" aria-labelledby="work-title">
      <pre class="ascii-header-title">{asciiArtHeader}</pre>
      <h1 id="work-title" class="sr-only">Work</h1>

      <section class="intro-section">
        <p>
          I've been building software for {years}+ years, starting with web development before
          shifting to mobile. I currently specialize in Flutter and Dart, creating cross-platform
          applications for Android, iOS, and Web with attention to both functionality and design.
        </p>
        <p>
          Along the way, I've developed strong skills in JavaScript (React and Vue), PHP (Laravel),
          C# (.NET), and the Firebase and Cloudflare ecosystems.
        </p>
        <p>
          You can view my complete resume <a
            href="/envidiado-resume-october-2025.pdf"
            target="_blank"
            class="highlight">here</a
          >.
        </p>
      </section>

      <section class="experience-section">
        <h2 class="section-title">Work Experience</h2>
        <div class="experience-list">
          {
            experiences.map((exp) => (
              <div class="experience-item">
                <h3 class="experience-role">{exp.role}</h3>
                <div class="experience-company-period">
                  {exp.company} ({exp.period})
                </div>
                <p class="experience-description">{exp.description}</p>
              </div>
            ))
          }
        </div>
      </section>

      <section class="projects-section">
        <h2 class="section-title">Project Showcase</h2>
        <div class="projects-list">
          {
            projects.map((project) => (
              <a href={project.url} class="project-item" target="_blank">
                <div class="project-image-container">
                  <Picture
                    src={project.image}
                    formats={['avif', 'webp']}
                    alt={project.alt}
                    class="project-image"
                  />
                </div>
                <div class="project-details">
                  <h2 class="project-title">
                    {project.title} <span class="arrow">↗</span>
                  </h2>
                  <p class="project-description">{project.description}</p>
                </div>
              </a>
            ))
          }
        </div>
      </section>

      <footer class="work-footer">
        To go back to the homepage, tap/type
        <a href="/" aria-label="Go to homepage">:home&lt;Enter&gt;</a>.
      </footer>
    </article>
  </div>
</BaseLayout>

<style lang="scss">
  .work-content {
    max-width: 600px;
    margin: 1.5rem;
    color: var(--foreground);
    text-align: left;
    padding: 0 1rem;

    @media (max-width: 600px) {
      margin: 1.5rem 0;
      padding: 0 1rem;
    }
  }

  .intro-section {
    margin-bottom: 1.5rem;

    p {
      line-height: 1.7;
      margin-bottom: 1rem;
    }
  }

  :global(.highlight) {
    color: var(--cyan);
    font-weight: 500;
  }

  .experience-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-top: 0.8rem;
  }

  .experience-item {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    position: relative;
    padding-left: 1.5rem;

    &::before {
      content: '-';
      position: absolute;
      left: 0;
      top: 0.4rem;
      color: var(--comment);
    }
  }

  .experience-company-period {
    color: var(--comment);
    margin-bottom: 0.15rem;
  }

  .experience-role {
    font-size: 1.2rem;
    font-weight: 500;
    color: var(--foreground);
    margin: 0.1rem 0;
  }

  .experience-description {
    color: var(--foreground);
    line-height: 1.6;
    margin: 0.2rem 0;
  }

  .projects-section {
    margin-top: 2rem;
  }

  .projects-list {
    display: flex;
    flex-direction: column;
    gap: 3rem;
    margin-top: 1rem;
  }

  .section-title {
    font-size: 1.5rem;
    margin-bottom: 0.6rem;
    margin-top: 2.5rem;
    font-weight: 500;
  }

  .project-item {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 2rem;
    text-decoration: none;
    color: inherit;
    align-items: start;

    &:hover {
      .project-title {
        text-decoration: underline;
      }
    }

    @media (max-width: 600px) {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }

  .project-image-container {
    width: 100%;
    aspect-ratio: 4/3;
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background-color: #333;
  }

  .project-image-placeholder {
    width: 100%;
    height: 100%;
    background-color: #333;
  }

  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .project-details {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .project-title {
    font-size: 1.1rem;
    line-height: 1.1;
    font-weight: 500;
    color: var(--cyan);
    margin: -0.2rem 0 0 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: opacity 0.2s ease;
  }

  .arrow {
    font-size: 0.9em;
  }

  .project-description {
    color: var(--foreground);
    line-height: 1.6;
    margin: 0;
  }

  .work-footer {
    color: var(--comment);
    white-space: nowrap;
    overflow-wrap: anywhere;
    padding-bottom: 3rem;
    padding-top: 3rem;
    line-height: 1.5;

    @media (max-width: 480px) {
      white-space: normal;
    }
  }
</style>
